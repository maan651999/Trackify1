@model IEnumerable<Trackify.Application.DTOs.ExpenseDto>
@{
    ViewData["Title"] = "Monthly Expenses";
}

<div class="container mt-5">
    <div class="card p-4 shadow rounded-4">
        <h1 class="budget-title">
            📅 Expenses
        </h1>

        <div class="table-responsive" style="max-height: 521px; overflow-y: auto;">
            <table class="table table-striped table-hover mb-0">
                <thead class="table-dark sticky-top">
                    <tr>
                        <th>Date</th>
                        <th>Category</th>
                        <th>Amount</th>
                        <th>Notes</th>
                        <th>Quantity</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.Date.ToString("dd MMMM yyyy")</td>
                            <td>
                                @{
                                    string category = item.CategoryName;
                                    if (!string.IsNullOrEmpty(category) && category.StartsWith("*"))
                                    {
                                        <span style="color: red; font-weight: 900;">*</span>
                                        @category.Substring(1).TrimStart()
                                        // baaki ka naam normal dikhe
                                    }
                                    else
                                    {
                                        @category
                                    }
                                }
                            </td>
                            <td>₹@item.Amount</td>
                            <td>@item.Notes</td>
                            <td>@item.Quantity</td>
                            <td>
                                <form asp-action="IncreaseQuantity" method="post" class="d-inline">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="id" value="@item.ExpenseId" />
                                    <button type="submit" class="btn btn-sm btn-outline-success" title="Increase Quantity">➕</button>
                                </form>
                                <a class="btn btn-sm btn-outline-warning" asp-action="Edit" asp-route-id="@item.ExpenseId">✏️</a>
                                <form asp-action="Delete" method="post" class="d-inline">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="id" value="@item.ExpenseId" />
                                    <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure?')">🗑️</button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <div class="text-center mt-4">
            <a href="/Expense/Add" class="btn btn-outline-info px-4 rounded-pill">➕ Add More</a>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        @if (TempData["SuccessMessage"] != null)
            {
                                    <text>
                                        Swal.fire({
                                                icon: 'success',
                                            title: 'Success',
                                            text: '@TempData["SuccessMessage"]',
                                            timer: 3000,
                                            timerProgressBar: true,
                                            showConfirmButton: false
                                        });
                                    </text>
            }
            else if (TempData["ErrorMessage"] != null)
            {
                                        <text>
                                            Swal.fire({
                                                icon: 'error',
                                                title: 'Failed',
                                                text: '@TempData["ErrorMessage"]',
                                                timer: 3000,
                                                timerProgressBar: true,
                                                showConfirmButton: false
                                            });
                                        </text>
            }
            @if (TempData["SuccessMessage"] != null)
        {
                            <text>
                                Swal.fire({
                                        icon: 'success',
                                        title: ' success Budget Allocation!',
                                        html: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(TempData["SuccessMessage"])),
                                    timer: 4000,
                                    timerProgressBar: true,
                                    showConfirmButton: false,
                                    background: '#fff',
                                    customClass: {
                                        title: 'swal-title-custom',
                                        htmlContainer: 'swal-text-custom'
                                    }
                                });
                            </text>
        }
        else if (TempData["ErrorMessage"] != null)
        {
                                <text>
                                    Swal.fire({
                                        icon: 'error',
                                        title: '🚫 Invalid Added!',
                                        html: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(TempData["ErrorMessage"])),
                                        timer: 4000,
                                        timerProgressBar: true,
                                        showConfirmButton: false,
                                        background: '#fff',
                                        customClass: {
                                            title: 'swal-title-custom',
                                            htmlContainer: 'swal-text-custom'
                                        }
                                    });
                                </text>
        }
    </script>
}

<style>
    .mt-5 {
        margin-top: 0rem !important;
        margin-left: 9rem !important;
    }

    .budget-title {
        margin-bottom: 12px;
    }
    /* Pure page me scroll band */
    html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
    }

    .swal-title-custom {
        font-size: 1.5rem !important;
        font-weight: 700 !important;
        color: #d9534f !important;
        text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
    }

    /* Message ko readable aur modern */
    .swal-text-custom {
        font-size: 1.1rem !important;
        font-weight: 500 !important;
        color: #333 !important;
        line-height: 1.5;
    }
</style>


